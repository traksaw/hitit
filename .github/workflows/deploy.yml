name: Deploy

on:
  push:
    branches: [main]
  workflow_dispatch: # Allow manual deployment

jobs:
  # Deploy Backend to Railway
  deploy-backend:
    name: Deploy Backend to Railway
    runs-on: ubuntu-latest
    needs: [] # CI is enforced via branch protection
    if: github.ref == 'refs/heads/main'

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Trigger Railway deployment
        if: ${{ secrets.RAILWAY_DEPLOY_HOOK != '' }}
        run: |
          curl -X POST "${{ secrets.RAILWAY_DEPLOY_HOOK }}"
          echo "✅ Railway deployment triggered"

  # Deploy Frontend to Vercel/Netlify
  deploy-frontend:
    name: Deploy Frontend
    runs-on: ubuntu-latest
    needs: [] # CI is enforced via branch protection
    if: github.ref == 'refs/heads/main'

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Trigger Vercel deployment
        if: ${{ secrets.VERCEL_DEPLOY_HOOK != '' }}
        run: |
          curl -X POST "${{ secrets.VERCEL_DEPLOY_HOOK }}"
          echo "✅ Vercel deployment triggered"

      - name: Trigger Netlify deployment
        if: ${{ secrets.NETLIFY_BUILD_HOOK != '' }}
        run: |
          curl -X POST -d '{}' "${{ secrets.NETLIFY_BUILD_HOOK }}"
          echo "✅ Netlify deployment triggered"
